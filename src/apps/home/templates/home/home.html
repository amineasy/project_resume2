{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/home.css' %}">
{% endblock %}

{% block title %}خانه{% endblock %}

{% block body %}
    <header>
        <nav>
            <div class="dropdown">
                <button class="dropbtn">دسته‌بندی‌ها</button>
                <div class="dropdown-content">
                    {% for node in category %}
                        {% include "home/category_dropdown.html" with node=node %}
                    {% empty %}
                        <p>هیچ دسته‌بندی‌ای یافت نشد.</p>
                    {% endfor %}
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="products">
            <h2>محصولات پرفروش</h2>
            <div class="product-grid">
                {% for product in top_selling %}
                    <div class="product-card">
                        <img src="{{ product.images.first.image.url }}" alt="{{ product.title }}">
                        <h3>{{ product.title }}</h3>
                        {% if product.discount_price %}
                            <p class="original-price">{{ product.price }} تومان</p>
                            <p class="discount-price">{{ product.discount_price }} %</p>
                            <p class="total-price">{{ product.total_price }} تومان</p>
                        {% else %}
                            <p class="total-price">{{ product.price }} تومان</p>
                        {% endif %}
                        <a href="{% url 'home:product_detail' product.id product.slug %}" class="btn">مشاهده</a>
                    </div>
                {% empty %}
                    <p>محصولی یافت نشد.</p>
                {% endfor %}
            </div>
            <div class="view-all-wrapper">
                <a href="{% url 'home:most_viewed' %}?sort=top-selling" class="btn view-all-btn">مشاهده همه</a>
            </div>

        </section>

        <section class="products">
            <h2>محصولات پربازدید</h2>
            <div class="product-grid">
                {% for product in most_viewed %}
                    <div class="product-card">
                        <img src="{{ product.images.first.image.url }}" alt="{{ product.title }}">
                        <h3>{{ product.title }}</h3>
                        {% if product.discount_price %}
                            <p class="original-price">{{ product.price }} تومان</p>
                            <p class="discount-price">{{ product.discount_price }} ٪</p>
                            <p class="total-price">{{ product.total_price }} تومان</p>
                        {% else %}
                            <p class="total-price">{{ product.price }} تومان</p>
                        {% endif %}
                        <a href="{% url 'home:product_detail' product.id product.slug %}" class="btn">مشاهده</a>
                    </div>
                {% empty %}
                    <p>محصولی یافت نشد.</p>
                {% endfor %}
            </div>
        <div class="view-all-wrapper">
            <a href="{% url 'home:top_selling' %}?sort=top-selling" class="btn view-all-btn">مشاهده همه</a>
        </div>

        </section>
    </main>

    <script src="{% static 'home/js/home.js' %}"></script>
{% endblock %}