{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/base.css' %}">
<link rel="stylesheet" href="{% static 'home/css/product_detail.css' %}">
{% endblock %}

{% block title %}{{ product.title }}{% endblock %}

{% block body %}
<div class="product-detail">

    <h1>{{ product.title }}</h1>
    <p>{{ product.description }}</p>

    <!-- Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ -->
    <form action="{% url 'home:product_favourite' product.id %}" method="post" class="favourite-form">
        {% csrf_token %}
        <button type="submit" class="favourite-btn">
            {% if is_favourite %}
                â¤ï¸ Ø­Ø°Ù Ø§Ø² Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ
            {% else %}
                ğŸ¤ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ
            {% endif %}
        </button>
    </form>

    <!-- Ø±Ù†Ú¯ -->
    {% if has_colors %}
    <div class="variant">
        <label for="color">Ø±Ù†Ú¯:</label>
        <select id="color">
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
            {% for color in colors %}
                <option value="{{ color.color__id }}">{{ color.color__color }}</option>
            {% endfor %}
        </select>
    </div>
    {% endif %}

    <!-- Ø³Ø§ÛŒØ² -->
    {% if has_sizes %}
    <div class="variant">
        <label for="size">Ø³Ø§ÛŒØ²:</label>
        <select id="size">
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
            {% for size in sizes %}
                <option value="{{ size.size__id }}">{{ size.size__size }}</option>
            {% endfor %}
        </select>
    </div>
    {% endif %}

    <!-- Ù‚ÛŒÙ…Øª -->
    <div class="price-box" id="price-box">
        {% if default_attribute %}
            {% if default_attribute.get_discount_price %}
                <span class="discount">{{ default_attribute.get_price }} ØªÙˆÙ…Ø§Ù†</span>
                <span class="price">{{ default_attribute.get_discount_price }} ØªÙˆÙ…Ø§Ù†</span>
            {% else %}
                <span class="price">{{ default_attribute.get_price }} ØªÙˆÙ…Ø§Ù†</span>
            {% endif %}
        {% else %}
            <span>Ù‚ÛŒÙ…ØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</span>
        {% endif %}
    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ (ÙØ¹Ù„Ø§Ù‹ Ù†Ù…Ø§ÛŒØ´ÛŒ) -->
    <button class="add-to-cart-btn">ğŸ›’ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>

</div>

<!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª -->
<script>
    const variantData = {{ variant_data|safe }};
    const colorSelect = document.getElementById('color');
    const sizeSelect = document.getElementById('size');
    const priceBox = document.getElementById('price-box');

    function updatePrice() {
        const selectedColor = colorSelect?.value || null;
        const selectedSize = sizeSelect?.value || null;

        const match = variantData.find(item =>
            (item.color_id == selectedColor || !selectedColor) &&
            (item.size_id == selectedSize || !selectedSize)
        );

        if (match) {
            priceBox.innerHTML = match.discount_price
                ? `<span class="discount">${match.price} ØªÙˆÙ…Ø§Ù†</span><span class="price">${match.discount_price} ØªÙˆÙ…Ø§Ù†</span>`
                : `<span class="price">${match.total_price} ØªÙˆÙ…Ø§Ù†</span>`;
        } else {
            priceBox.innerHTML = '<span>Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</span>';
        }
    }

    if (colorSelect) colorSelect.addEventListener('change', updatePrice);
    if (sizeSelect) sizeSelect.addEventListener('change', updatePrice);
</script>
{% endblock %}
